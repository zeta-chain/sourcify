version: "3.7"
x-project-repository-mount: &project-repository-mount
  type: bind
  source: $REPOSITORY_PATH
  read_only: true

x-project-base: &project-base
  env_file:
    - .env
  restart: always
  networks:
    - source-verify
networks:
  source-verify:
# volumes:
#   db:
#   h5ai:
#     driver: local

services:
  repository:
    <<: *project-base
    #image: ethereum/source-verify:repository-${TAG}
    build:
      context: ../h5ai-nginx # Point to the /h5ai-nginx folder - use `git submodule update --init --recursive` to get it
      dockerfile: Dockerfile
    container_name: repository-${TAG}
    volumes:
      - <<: *project-repository-mount
        target: /data
        read_only: true
    ports:
      - ${REPOSITORY_SERVER_EXTERNAL_PORT}:80
